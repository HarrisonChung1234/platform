{"ast":null,"code":"import axios from 'axios';\nimport Cookies from 'js-cookie';\nexport default {\n  data() {\n    return {\n      rules: {\n        value1: [{\n          required: true,\n          trigger: 'change'\n        }],\n        value2: [{\n          required: true,\n          trigger: 'change'\n        }],\n        value3: [{\n          required: true,\n          trigger: 'change'\n        }],\n        value4: [{\n          required: true,\n          trigger: 'change'\n        }]\n      },\n      ruleForm: {\n        value1: '',\n        value2: '',\n        value3: '',\n        value4: ''\n      },\n      model_name: [],\n      model_type: ['yolo_v5'],\n      p_set: [],\n      p_name: ['PCB1.jpg', 'PCB2.jpg', 'PCB3.jpg', 'PCB4.jpg', 'PCB5.jpg', 'PCB6.jpg', 'PCB7.jpg'],\n      img_stream: '',\n      img_url: ''\n    };\n  },\n  created() {\n    // 从后台获取数据集列表\n    axios.get('http://127.0.0.1:5000/model/detect', {\n      params: {\n        step: '1'\n      },\n      headers: {\n        'Authorization': 'Bearer ' + Cookies.get('token'),\n        'Content-Type': \"application/json\"\n      }\n    }).then(response => {\n      this.model_name = response.data;\n      this.p_set = response.data;\n    }).catch(error => {\n      console.error(error);\n    });\n  },\n  methods: {\n    getPicList(value) {\n      // 获取图片罢\n      axios.get('http://127.0.0.1:5000/model/detect', {\n        params: {\n          step: '2',\n          ds_name: value\n        },\n        headers: {\n          'Authorization': 'Bearer ' + Cookies.get('token'),\n          'Content-Type': \"application/json\"\n        }\n      }).then(response => {\n        this.p_name = response.data.image_names;\n      }).catch(error => {\n        console.log(error.data);\n      });\n    },\n    submitDetect() {\n      axios.post('http://127.0.0.1:5000/model/detect', {\n        model_name: this.ruleForm.value1,\n        model_type: this.ruleForm.value2,\n        p_set: this.ruleForm.value3,\n        p_name: this.ruleForm.value4\n      }, {\n        headers: {\n          'Authorization': 'Bearer ' + Cookies.get('token'),\n          'Content-Type': 'application/json'\n        }\n      }).then(response => {\n        this.img_stream = response.data;\n      }).catch(error => {\n        console.error(error);\n      });\n    },\n    startDownload() {\n      // 创建一个链接元素\n      var a = document.createElement('a');\n      a.href = 'data:;base64,' + this.img_stream; // 图片的URL\n      a.download = this.ruleForm.value4;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n    }\n  }\n};","map":{"version":3,"names":["axios","Cookies","data","rules","value1","required","trigger","value2","value3","value4","ruleForm","model_name","model_type","p_set","p_name","img_stream","img_url","created","get","params","step","headers","then","response","catch","error","console","methods","getPicList","value","ds_name","image_names","log","submitDetect","post","startDownload","a","document","createElement","href","download","body","appendChild","click","removeChild"],"sources":["src/views/Detect.vue"],"sourcesContent":["<template>\n    <div>\n        <div class=\"container\">\n            <el-form label-position=\"top\" label-width=\"100px\" class=\"demo-ruleForm\" :model=\"ruleForm\" :rules=\"rules\"\n                status-icon ref=\"ruleForm\">\n                <el-form-item label=\"训练集\" prop=\"value1\" style=\"margin-top: 4%;\">\n                    <el-select v-model=\"ruleForm.value1\" placeholder=\"请选择训练集\">\n                        <el-option v-for=\"item in model_name\" :key=\"item\" :label=\"item\" :value=\"item\">\n                        </el-option>\n                    </el-select>\n                </el-form-item>\n                <el-form-item label=\"模型\" prop=\"value2\">\n                    <el-select v-model=\"ruleForm.value2\" placeholder=\"请选择模型\">\n                        <el-option v-for=\"item in model_type\" :key=\"item\" :label=\"item\" :value=\"item\">\n                        </el-option>\n                    </el-select>\n                </el-form-item>\n                <el-form-item label=\"测试集\" prop=\"value3\">\n                    <el-select v-model=\"ruleForm.value3\" placeholder=\"请选择要检测的数据集\">\n                        <el-option v-for=\"item in p_set\" :key=\"item\" :label=\"item\" :value=\"item\">\n                        </el-option>\n                    </el-select>\n                </el-form-item>\n                <el-form-item @change=\"getPicList\" label=\"测试集中的照片\" prop=\"value4\">\n                    <el-select v-model=\"ruleForm.value4\" :disabled=\"p_name.length === 0 ? true : false\"\n                        placeholder=\"请先选择要检测的数据集\">\n                        <el-option v-for=\"item in p_name\" :key=\"item\" :label=\"item\" :value=\"item\">\n                        </el-option>\n                    </el-select>\n                </el-form-item>\n                <div style=\"text-align: center;margin-top: 10%;margin-bottom: 3%;\">\n                    <el-button slot=\"trigger\" size=\"small\" type=\"primary\" @click=\"submitDetect\">检测</el-button>\n                </div>\n            </el-form>\n        </div>\n        <div class=\"rcontainer\">\n            <div class=\"imgPart\" v-if=\"img_stream\">\n                <img :src=\"'data:;base64,' + img_stream\" style=\"width: 480px;\" @click=\"startDownload\">\n                <h3 style=\"text-align: center;\">点击图片即可下载标记后的图片</h3>\n            </div>\n            <div class=\"textPart\" v-else>\n                <h1 style=\"font-size: 40px;\">检测后的图片会显示在这</h1>\n            </div>\n        </div>\n    </div>\n</template>\n<script>\nimport axios from 'axios'\nimport Cookies from 'js-cookie'\nexport default {\n    data() {\n        return {\n            rules: {\n                value1: [\n                    { required: true, trigger: 'change' }\n                ],\n                value2: [\n                    { required: true, trigger: 'change' }\n                ],\n                value3: [\n                    { required: true, trigger: 'change' }\n                ],\n                value4: [\n                    { required: true, trigger: 'change' }\n                ]\n            },\n            ruleForm: {\n                value1: '',\n                value2: '',\n                value3: '',\n                value4: '',\n            },\n            model_name: [],\n            model_type: [\n                'yolo_v5'\n            ],\n            p_set: [],\n            p_name: ['PCB1.jpg','PCB2.jpg','PCB3.jpg','PCB4.jpg','PCB5.jpg','PCB6.jpg','PCB7.jpg',],\n            img_stream: '',\n            img_url: ''\n        }\n    },\n    created() {\n        // 从后台获取数据集列表\n        axios.get('http://127.0.0.1:5000/model/detect', {\n            params: {\n                step: '1'\n            },\n            headers: {\n                'Authorization': 'Bearer ' + Cookies.get('token'),\n                'Content-Type': \"application/json\"\n            }\n        })\n            .then((response) => {\n                this.model_name = response.data\n                this.p_set = response.data\n            })\n            .catch((error) => {\n                console.error(error);\n            });\n    },\n    methods: {\n        getPicList(value) {\n            // 获取图片罢\n            axios.get('http://127.0.0.1:5000/model/detect', {\n                params: {\n                    step: '2',\n                    ds_name: value\n                },\n                headers: {\n                    'Authorization': 'Bearer ' + Cookies.get('token'),\n                    'Content-Type': \"application/json\"\n                }\n            }).then((response) => {\n                this.p_name = response.data.image_names\n            }).catch((error) => {\n                console.log(error.data)\n            });\n        },\n        submitDetect() {\n            axios.post('http://127.0.0.1:5000/model/detect', {\n                model_name: this.ruleForm.value1,\n                model_type: this.ruleForm.value2,\n                p_set: this.ruleForm.value3,\n                p_name: this.ruleForm.value4\n            }, {\n                headers: {\n                    'Authorization': 'Bearer ' + Cookies.get('token'),\n                    'Content-Type': 'application/json'\n                }\n            }).then((response) => {\n                this.img_stream = response.data\n            }).catch((error) => {\n                console.error(error);\n            });\n        },\n        startDownload() {\n            // 创建一个链接元素\n            var a = document.createElement('a')\n            a.href = 'data:;base64,' + this.img_stream// 图片的URL\n            a.download = this.ruleForm.value4\n            document.body.appendChild(a)\n            a.click()\n            document.body.removeChild(a)\n        }\n    }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.container {\n    position: absolute;\n    box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.2);\n    top: 58%;\n    left: 32%;\n    width: 20rem;\n    height: 33rem;\n    background-color: #fff;\n\n    .el-select {\n        position: relative;\n        margin: 0%;\n        margin-left: 10%;\n    }\n}\n\n.rcontainer {\n    .textPart {\n        position: absolute;\n        top: 45%;\n        left: 55%;\n    }\n\n    .imgPart {\n        position: absolute;\n        top: 27%;\n        left: 55%;\n    }\n}\n</style>"],"mappings":"AA+CA,OAAAA,KAAA;AACA,OAAAC,OAAA;AACA;EACAC,KAAA;IACA;MACAC,KAAA;QACAC,MAAA,GACA;UAAAC,QAAA;UAAAC,OAAA;QAAA,EACA;QACAC,MAAA,GACA;UAAAF,QAAA;UAAAC,OAAA;QAAA,EACA;QACAE,MAAA,GACA;UAAAH,QAAA;UAAAC,OAAA;QAAA,EACA;QACAG,MAAA,GACA;UAAAJ,QAAA;UAAAC,OAAA;QAAA;MAEA;MACAI,QAAA;QACAN,MAAA;QACAG,MAAA;QACAC,MAAA;QACAC,MAAA;MACA;MACAE,UAAA;MACAC,UAAA,GACA,UACA;MACAC,KAAA;MACAC,MAAA;MACAC,UAAA;MACAC,OAAA;IACA;EACA;EACAC,QAAA;IACA;IACAjB,KAAA,CAAAkB,GAAA;MACAC,MAAA;QACAC,IAAA;MACA;MACAC,OAAA;QACA,6BAAApB,OAAA,CAAAiB,GAAA;QACA;MACA;IACA,GACAI,IAAA,CAAAC,QAAA;MACA,KAAAZ,UAAA,GAAAY,QAAA,CAAArB,IAAA;MACA,KAAAW,KAAA,GAAAU,QAAA,CAAArB,IAAA;IACA,GACAsB,KAAA,CAAAC,KAAA;MACAC,OAAA,CAAAD,KAAA,CAAAA,KAAA;IACA;EACA;EACAE,OAAA;IACAC,WAAAC,KAAA;MACA;MACA7B,KAAA,CAAAkB,GAAA;QACAC,MAAA;UACAC,IAAA;UACAU,OAAA,EAAAD;QACA;QACAR,OAAA;UACA,6BAAApB,OAAA,CAAAiB,GAAA;UACA;QACA;MACA,GAAAI,IAAA,CAAAC,QAAA;QACA,KAAAT,MAAA,GAAAS,QAAA,CAAArB,IAAA,CAAA6B,WAAA;MACA,GAAAP,KAAA,CAAAC,KAAA;QACAC,OAAA,CAAAM,GAAA,CAAAP,KAAA,CAAAvB,IAAA;MACA;IACA;IACA+B,aAAA;MACAjC,KAAA,CAAAkC,IAAA;QACAvB,UAAA,OAAAD,QAAA,CAAAN,MAAA;QACAQ,UAAA,OAAAF,QAAA,CAAAH,MAAA;QACAM,KAAA,OAAAH,QAAA,CAAAF,MAAA;QACAM,MAAA,OAAAJ,QAAA,CAAAD;MACA;QACAY,OAAA;UACA,6BAAApB,OAAA,CAAAiB,GAAA;UACA;QACA;MACA,GAAAI,IAAA,CAAAC,QAAA;QACA,KAAAR,UAAA,GAAAQ,QAAA,CAAArB,IAAA;MACA,GAAAsB,KAAA,CAAAC,KAAA;QACAC,OAAA,CAAAD,KAAA,CAAAA,KAAA;MACA;IACA;IACAU,cAAA;MACA;MACA,IAAAC,CAAA,GAAAC,QAAA,CAAAC,aAAA;MACAF,CAAA,CAAAG,IAAA,0BAAAxB,UAAA;MACAqB,CAAA,CAAAI,QAAA,QAAA9B,QAAA,CAAAD,MAAA;MACA4B,QAAA,CAAAI,IAAA,CAAAC,WAAA,CAAAN,CAAA;MACAA,CAAA,CAAAO,KAAA;MACAN,QAAA,CAAAI,IAAA,CAAAG,WAAA,CAAAR,CAAA;IACA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}